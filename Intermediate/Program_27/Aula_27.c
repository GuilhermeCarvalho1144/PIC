//CURSO DE PIC
//PROGRAMA 27...ESSE PROGRAMA FOI DESENVOLVIDO PARA IMPLEMETAR A VARREDURA DE BOTÕES POR INTERRUPÇÕES
//O MICROCONTROLADOR USADO FOI PIC16F628A
//MAIS INFORMÇÕES NO LINK : https://www.youtube.com/watch?v=g6Y4AvJUOW0&list=PLZ8dBTV2_5HQ-LrS9r1dP30h8n9sh04gh&t=902s&index=27
//GUILHERME CARVALHO PEREIRA
//INICIO

//MAPEAMENTO DE HARDWARE
#define S1 RA0_bit
#define S2 RA1_bit
#define LED1 RA2_bit
#define LED2 RA3_bit

/*ESSA FUNÇÃO JÁ É IMPLEMENTADA NO MIKROC...ELA AJUDA O PROGRAMADOR A TRATAR DE INTERRUPÇÕES (VEJA O HELP)....
ESSA FUNÇÃO É DO TIPO VOID, PORTANTO NAO POSSUI RETONO...TAMBÉM NÃO POSSUI NENHUM TIPO DE PARAMETRO...
*/
void interrupt(){//A VERREDURA DOS BOTÕES OCORRE APROXIMADAMENTE A CADA 20ms
     if(T0IF_bit){          //TESTA SE HOUVE INTERRUPÇÃO POR ESTOURO DO TIMER 0
     T0IF_bit = 0x00;       //LIMPA A FLAG DE INTERRUPÇÃO...***IMPORTANTE***
     TMR0 = 0x6C;           //INICIA NOVAMENTE O TIMER 0
                  if(!S1)LED2 = 0x01;          //CASO S1 ESTIVER PRECIONADO ACENDE O LED2
                  else if(!S2)LED2 = 0x00;     //CASO S2 ESTIVER PRECIONADO APAGA O LED2
     }
}

//FUNÇÃO MAIN
void main() {
     //CONFIGURANDO OS REGITRADORES
     CMCON = 0x07;          //DESABILITA OS COMPARADORES
     //CONFIGURANDO OS REGISTRADORES DE INTERRUPÇÃO
     OPTION_REG = 0x86;              //DESABILITA OS RESISTORES DE PULL UP
                                     //DEFINE O PRESCALER 1:128....O TIMER 0 INCRMNETA A CADA 128
                                     //CILOS DE MAQUINA...O CICLO DE MAQUINA TEM 1us
     GIE_bit = 0x01;                 //HABILITA AS INTERRUPÇÕES
     PEIE_bit = 0x01;                //HABILITA AS INTERRUPÇÕES POR PERIFERICOS
     T0IE_bit = 0x01;                //HABILITA AS INTERRUPÇÕES POR TIMER 0
     TMR0 = 0x6C;                    //INICIA O TIMER 0
     //CONFIGURANDO O PORT DE ENTRADA
     TRISA = 0x03;                   //DEFINE RA0 E RA1 COMO ENTRADA DIGITAIS
     PORTA = 0x03;                   //INCIANDO O PORTA
     //LOOP PRINCIPAL
     while(1){//FAZ UM BLINK NO LED1 DE 0,5s
              LED1 = 0x01;
              delay_ms(500);
              LED1 = 0x00;
              delay_ms(500);
     }
}
//FIM